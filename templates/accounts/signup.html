{% extends "base.html" %}
{% block title %}Sign up - PETio{% endblock %}
{% block content %}
<div class="container mx-auto max-w-md py-10">
  <div class="enhanced-card">
    <div class="flex items-center gap-3 mb-4">
      <div class="avatar placeholder">
        <div class="bg-secondary text-secondary-content rounded-full w-10">
          <span class="text-lg"><i class="fas fa-user-plus"></i></span>
        </div>
      </div>
      <h1 class="text-2xl font-bold">Create your PETio account</h1>
    </div>

    {% if form.non_field_errors %}
      <div class="alert alert-error mb-4"><i class="fas fa-exclamation-triangle mr-2"></i>{{ form.non_field_errors }}</div>
    {% endif %}

    <form method="post" class="space-y-4" id="signup-form">
      {% csrf_token %}
      <div>
        <label for="id_username" class="block mb-1 font-medium">Username</label>
        {{ form.username }}
        {% if form.username.errors %}<p class="text-error text-sm mt-1">{{ form.username.errors.0 }}</p>{% endif %}
      </div>
      <div>
        <label for="id_email" class="block mb-1 font-medium">Email (optional)</label>
        {{ form.email }}
        <p class="text-xs text-base-content/70 mt-1">We'll use this for notifications and activation.</p>
        {% if form.email.errors %}<p class="text-error text-sm mt-1">{{ form.email.errors.0 }}</p>{% endif %}
      </div>
      <div>
        <label for="id_password1" class="block mb-1 font-medium">Password</label>
        <div class="relative">
          {{ form.password1 }}
          <button type="button" id="toggle-password1" class="btn btn-ghost btn-xs absolute right-2 top-1/2 -translate-y-1/2" aria-label="Show or hide password"><i class="fas fa-eye"></i></button>
        </div>
        <p class="text-xs text-base-content/70 mt-1">Use at least 8 characters with a mix of letters, numbers, and symbols.</p>
        {% if form.password1.errors %}<p class="text-error text-sm mt-1">{{ form.password1.errors.0 }}</p>{% endif %}
      </div>
      <div>
        <label for="id_password2" class="block mb-1 font-medium">Confirm Password</label>
        <div class="relative">
          {{ form.password2 }}
          <button type="button" id="toggle-password2" class="btn btn-ghost btn-xs absolute right-2 top-1/2 -translate-y-1/2" aria-label="Show or hide password"><i class="fas fa-eye"></i></button>
        </div>
        {% if form.password2.errors %}<p class="text-error text-sm mt-1">{{ form.password2.errors.0 }}</p>{% endif %}
      </div>
      <div>
        <label for="id_mobile_number" class="block mb-1 font-medium">Mobile Number (optional)</label>
        {{ form.mobile_number }}
        <p class="text-xs text-base-content/70 mt-1">e.g., +63 912 345 6789</p>
        {% if form.mobile_number.errors %}<p class="text-error text-sm mt-1">{{ form.mobile_number.errors.0 }}</p>{% endif %}
      </div>
      <div>
        <label for="id_age" class="block mb-1 font-medium">Age (optional)</label>
        {{ form.age }}
        <p class="text-xs text-base-content/70 mt-1">e.g., 25</p>
        {% if form.age.errors %}<p class="text-error text-sm mt-1">{{ form.age.errors.0 }}</p>{% endif %}
      </div>
      <div class="flex items-center gap-2">
        {{ form.marketing_opt_in }}
        <label for="id_marketing_opt_in" class="font-medium">Send me product updates and tips</label>
        {% if form.marketing_opt_in.errors %}<p class="text-error text-sm mt-1">{{ form.marketing_opt_in.errors.0 }}</p>{% endif %}
      </div>
      {% if request.GET.next %}
        <input type="hidden" name="next" value="{{ request.GET.next }}">
      {% endif %}
      <button type="submit" class="btn btn-primary btn-enhanced w-full" id="signup-submit">Sign up</button>
    </form>

    <p class="mt-4 text-sm">Already have an account? <a href="{% url 'login' %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}" class="link">Log in</a></p>
  </div>
</div>

<script>
// Enhance inputs: add Tailwind/DaisyUI classes, placeholders, autocomplete, show/hide toggles, and loading state
(function(){
  function enhanceInput(id, placeholder, autocomplete){
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.add('input','input-bordered','w-full','form-control-enhanced');
    if (placeholder) el.setAttribute('placeholder', placeholder);
    if (autocomplete) el.setAttribute('autocomplete', autocomplete);
  }
  enhanceInput('id_username','Choose a unique username','username');
  enhanceInput('id_email','you@example.com','email');
  enhanceInput('id_password1','Create a strong password','new-password');
  enhanceInput('id_password2','Re-enter your password','new-password');
  enhanceInput('id_mobile_number','e.g., +63 912 345 6789','tel');
  enhanceInput('id_age','e.g., 25','age');

  const pw1 = document.getElementById('id_password1');
  const pw2 = document.getElementById('id_password2');
  const t1 = document.getElementById('toggle-password1');
  const t2 = document.getElementById('toggle-password2');
  function toggle(btn, input){
    if (!btn || !input) return;
    btn.addEventListener('click', function(){
      const isPw = input.getAttribute('type') === 'password';
      input.setAttribute('type', isPw ? 'text' : 'password');
      btn.innerHTML = isPw ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
    });
  }
  toggle(t1, pw1); toggle(t2, pw2);

  const form = document.getElementById('signup-form');
  const submitBtn = document.getElementById('signup-submit');
  if (form && submitBtn && typeof window.setButtonLoading === 'function') {
    form.addEventListener('submit', function(){
      window.setButtonLoading(submitBtn, true);
    });
  }
})();
</script>
{% endblock %}